<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your profile ‚Äì MeetXBuild</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body data-page="profile">
  <div class="anime-bg" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
  </div>
  <div class="anime-scan" aria-hidden="true"></div>

  <nav class="navbar">
    <div class="logo">MeetXBuild</div>
  </nav>

  <main class="container">
    <div class="form-card">
      <h2>Your founder profile</h2>
      <form id="profileForm">
        <div class="form-field">
          <label>Full name</label>
          <input name="fullName" required>
        </div>

        <div class="form-field">
          <label>Role</label>
          <select name="role" required>
            <option value="">Select role</option>
            <option value="immigrant">Immigrant (on visa)</option>
            <option value="non-immigrant">Non-immigrant</option>
          </select>
        </div>

        <div class="form-field">
          <label>Immigration / Visa status</label>
          <input name="visaStatus" placeholder="F-1 STEM OPT, H-1B, O-1, Citizen..." required>
        </div>

        <div class="form-field">
          <label>Current occupation</label>
          <input name="occupation" required>
        </div>

        <div class="form-field">
          <label>State</label>
          <select id="stateSelect" name="state" required>
            <option value="">Select state</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="DC">District of Columbia</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>
        </div>

        <div class="form-field" id="cityField">
          <label>City</label>
          <select id="citySelect" name="city" required>
            <option value="">Select city</option>
          </select>
          <input id="cityManual" name="city" type="text" placeholder="Enter city" style="display:none;margin-top:8px;">
        </div>

        <div class="form-field">
          <label>Skills (comma separated)</label>
          <input name="skills" required>
        </div>

        <div class="form-field">
          <label>Technical skills</label>
          <select id="techSelect" multiple size="6" aria-label="Technical skills (select multiple)">
            <option value="JavaScript">JavaScript</option>
            <option value="TypeScript">TypeScript</option>
            <option value="React">React</option>
            <option value="Node.js">Node.js</option>
            <option value="Python">Python</option>
            <option value="Django">Django</option>
            <option value="Go">Go</option>
            <option value="AWS">AWS</option>
            <option value="GCP">GCP</option>
            <option value="DevOps">DevOps</option>
            <option value="Data Science">Data Science</option>
            <option value="Other">Other</option>
          </select>
          <input id="techManual" type="text" placeholder="If Other, enter tech(s) comma separated" style="display:none;margin-top:8px;">
          <input type="hidden" name="techSkills" value="">
        </div>

        <div class="form-field">
          <label>Profile photo</label>
          <div style="display:flex;gap:12px;align-items:center;">
            <input id="photo" name="photoFile" type="file" accept="image/jpeg,image/jpg,image/png,image/webp" style="display:none">
            <input type="hidden" name="photoUrl" value="">
            <label for="photo" class="btn-secondary" style="cursor:pointer;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);">Choose photo</label>
            <button type="button" id="removePhotoBtn" class="btn-ghost" style="padding:6px 10px;border-radius:8px;display:none">Remove</button>
          </div>
          <img id="photoPreview" alt="photo preview" style="max-width:160px;display:none;border-radius:12px;margin-top:8px;">
        </div>

        <div class="form-actions">
          <button class="btn-primary" type="submit">Save & start swiping</button>
        </div>
      </form>
    </div>
  </main>

  <!-- core app logic -->
  <script type="module" src="app.js"></script>

  <!-- cities + tech skills sync -->
  <script>
    const STATE_CITIES = {
      "CA": ["San Francisco","Los Angeles","San Diego","Sacramento","San Jose"],
      "NY": ["New York","Buffalo","Rochester","Albany"],
      "TX": ["Austin","Houston","Dallas","San Antonio"],
      "FL": ["Miami","Orlando","Tampa","Tallahassee"],
      "WA": ["Seattle","Spokane","Tacoma"],
      "IL": ["Chicago","Springfield","Naperville"],
      "MA": ["Boston","Cambridge","Worcester"],
      "NJ": ["Newark","Jersey City","Princeton"],
      "GA": ["Atlanta","Savannah"],
      "PA": ["Philadelphia","Pittsburgh"]
    };

    const techSelect  = document.getElementById('techSelect');
    const techManual  = document.getElementById('techManual');
    const techHidden  = document.querySelector('input[name="techSkills"]');

    function syncTechSkills() {
      if (!techSelect || !techHidden) return;
      const selected = Array.from(techSelect.selectedOptions).map(o => o.value).filter(Boolean);
      if (selected.includes('Other')) {
        techManual.style.display = 'block';
        techManual.required = true;
        const manualVal = techManual.value.trim();
        if (manualVal) {
          const idx = selected.indexOf('Other');
          selected.splice(idx, 1, ...manualVal.split(',').map(s => s.trim()).filter(Boolean));
        }
      } else {
        techManual.style.display = 'none';
        techManual.required = false;
      }
      techHidden.value = selected.join(',');
    }

    techSelect?.addEventListener('change', syncTechSkills);
    techManual?.addEventListener('input', syncTechSkills);
    document.getElementById('profileForm')?.addEventListener('submit', syncTechSkills);

    const stateSelect = document.getElementById('stateSelect');
    const citySelect  = document.getElementById('citySelect');
    const cityManual  = document.getElementById('cityManual');

    function populateCitiesFor(state) {
      citySelect.innerHTML = '<option value="">Select city</option>';
      const cities = STATE_CITIES[state];
      if (cities && cities.length) {
        cityManual.style.display = 'none';
        citySelect.style.display = 'block';
        cities.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c;
          opt.textContent = c;
          citySelect.appendChild(opt);
        });
        citySelect.required = true;
        cityManual.required = false;
      } else {
        citySelect.style.display = 'none';
        citySelect.required = false;
        cityManual.style.display = 'block';
        cityManual.required = true;
      }
    }

    stateSelect.addEventListener('change', (e) => populateCitiesFor(e.target.value));
    if (stateSelect.value) populateCitiesFor(stateSelect.value);
  </script>

  <!-- photo preview / remove (no upload here) -->
  <script>
    (function() {
      const input   = document.getElementById('photo');
      const remove  = document.getElementById('removePhotoBtn');
      const preview = document.getElementById('photoPreview');
      if (!input) return;

      const label = document.querySelector('label[for="photo"]');
      if (label) {
        label.addEventListener('click', () => {
          try { input.click(); } catch (e) {}
        });
      }

      input.addEventListener('change', () => {
        if (input.files && input.files[0]) {
          remove.style.display = 'inline-block';
          preview.style.display = 'block';
          preview.src = URL.createObjectURL(input.files[0]);
        } else {
          remove.style.display = 'none';
          preview.style.display = 'none';
          preview.src = '';
        }
      });

      remove.addEventListener('click', () => {
        input.value = '';
        preview.src = '';
        preview.style.display = 'none';
        remove.style.display = 'none';
        const hidden = document.querySelector('input[name="photoUrl"]');
        if (hidden) hidden.value = '';
      });
    })();
  </script>

 <script type="module">
  // Wait for app.js to expose saveProfile and then wire the form submit.
  async function waitFor(fnName, timeoutMs = 5000) {
    const start = Date.now();
    while (typeof window[fnName] !== 'function' && Date.now() - start < timeoutMs) {
      await new Promise(r => setTimeout(r, 100));
    }
    return typeof window[fnName] === 'function';
  }

  (async () => {
    const ready = await waitFor('saveProfile', 7000);
    const form = document.getElementById('profileForm');
    if (!form) {
      console.error('profile.html: profileForm not found');
      return;
    }
    if (!ready) console.warn('profile.html: saveProfile not ready ‚Äî app.js may not have loaded');

    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      try {
        console.log('profile: submit clicked');

        const name   = form.querySelector('input[name="fullName"]')?.value?.trim();
        const skills = (form.querySelector('input[name="skills"]')?.value || '').trim();

        if (!name)   { alert('Please enter your full name'); return; }
        if (!skills) { alert('Please enter at least one skill'); return; }

        // üëâ Let saveProfile handle photo upload & validation.
        if (typeof window.saveProfile === 'function') {
          await window.saveProfile(ev);
        } else {
          console.warn('saveProfile missing ‚Äî falling back to form.submit()');
          form.submit();
        }
      } catch (err) {
        console.error('profile: save failed', err);
        alert('Save failed: ' + (err.message || err));
      }
    });
  })();
</script>

  <nav class="bottom-nav">
    <a href="swipe.html">
      <div class="icon">‚ù§Ô∏è</div>
      <span class="label">Swipe</span>
    </a>
    <a href="matches.html">
      <div class="icon">üî•</div>
      <span class="label">Matches</span>
    </a>
    <a href="chats.html">
      <div class="icon">üí¨</div>
      <span class="label">Chats</span>
    </a>
    <a href="my-profile.html" class="active">
      <div class="icon">üë§</div>
      <span class="label">Profile</span>
    </a>
  </nav>
</body>
</html>



